# Сервис работы с PDF-файлами - Rohan

## Функциональность

Сервис отвечает за следующую функциональность:
1. **Отчетность**
    - Генерация и сохранение отчетности в S3
    - Предоставление списка с ссылками на отчеты в S3

2. **Электронные книги**
    - Сохранение PDF-книг в S3
    - Предоставленние ссылки на книги в S3

## Технологический стек

### Основные технологии
- **Язык программирования**: Kotlin (JDK 21)
- **Фреймворк**: Spring Boot 3.5

### Используемые модули Spring Boot
- Spring Data JDBC
- Spring Web
- Spring AOP
- Spring Actuator

### Вспомогательные технологии
1. **PostgreSQL** - хранение мета-информации об электронных книгах и отчетности
2. **Yandex S3** - хранение электронных книг и отчетности

## Интеграции

Сервис взаимодействует со следующими внутренними системами:
- gRPC запросы к **Gandalf**, для валидации пользовательского JWT токена

## Инструкция для запуска

Все необходимые для запуска сервиса технологии запускаются с помощью Docker Compose: `compose.yml`.
Для системы есть 2 процесса запуска: **локальный запуск** и **запуск в docker-контейнере**.

### Обязательны шаг для запуска

Для хранения изображений используется Yandex S3, бакеты S3 разворачиваются в Yandex Cloud.
Перед запуском нужно создать сервисный аккаунт в Yandex Cloud и создать 2 бакета для отчетности и электронных книг. Ниже указана конфигурация Yandex S3 в файле `src/main/resources/application.yml`, на место `text` нужно указать свою информацию.

```yaml
cloud:
  aws:
    credentials:
      access-key: text
      secret-key: text
    endpoint: text
    bucket-name:
      BOOK: lib-e-book
      REPORT: lib-report
```

### Локальный запуск

Для локального запуска достаточно запустить Docker Compose и локально поднять приложение (самый простой способ - встроенный запуск в Intellij IDEA).
Перед запуском нужно закомментировать сервис `app`, т.к. он будет поднят не в Docker-контейнере.

### Запуск в Docker

Перед запуском сервиса в Docker, нужно настроить конфигурацию. Для этого необходимо выполнить следующие шаги:
1. Создать конфигурационный файл `src/main/resources/application-prod.yml`
2. Добавить в `application-prod.yml` чувствительные данные: пароли, ключи API хосты и порты для внешних систем (для систем, запускаемых в Docker, должны использоваться порт внутри сети Docker и имя сервиса в Docker Compose).
3. Собрать приложение
```bash
./gradlew build
```
4. Перенести собранный JAR-файл в корневую директорию на один уровень с Compose-файлом.
5. Запустить Docker Compose
```bash
docker compose up -d
```

## Контакты
- **Разработчик**: Устинов Максим Павлович
- **Учебное заведение**: РТУ МИРЭА
- **Группа**: ИКБО-16-22
- **Год разработки**: 2025